rules_version = '2';

service firebase.storage {
  match /b/{bucket}/o {
    
    function isOwner(userId) {
      return request.auth != null && request.auth.uid == userId;
    }
  
    // Anyone can read any file. This is typical for public images.
    match /{allPaths=**} {
      allow read;
    }
    
    // Users can only write to their own avatar path.
    match /avatars/{userId} {
      allow write: if isOwner(userId);
    }
    
    // Users can only write images for content they own.
    // This rule is generic for all content types.
    match /{contentType}/{userId}/{contentId}/{imageName} {
      allow write: if isOwner(userId) &&
                   (contentType == 'posts' || 
                    contentType == 'listings' || 
                    contentType == 'jobs' || 
                    contentType == 'events' || 
                    contentType == 'offers' ||
                    contentType == 'promoPages');
    }
  }
}
